name: Terraform Validation

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  terraform:
    name: Terraform Format and Validate
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v2
      with:
        terraform_version: 1.6.0
    
    - name: Terraform Format Check
      run: terraform fmt -check -recursive
      continue-on-error: false
    
    - name: Terraform Init
      run: terraform init -backend=false
    
    - name: Terraform Validate
      run: terraform validate
    
    - name: Check for example.tfvars
      run: |
        if [ ! -f "example.tfvars" ]; then
          echo "Error: example.tfvars not found"
          exit 1
        fi
        echo "✅ example.tfvars exists"
    
    - name: Check setup.sh is executable
      run: |
        if [ ! -x "setup.sh" ]; then
          echo "Error: setup.sh is not executable"
          exit 1
        fi
        echo "✅ setup.sh is executable"
    
    - name: Verify required files
      run: |
        required_files=(
          "README.md"
          "tutorial.md"
          "main.tf"
          "variables.tf"
          "outputs.tf"
          "setup.sh"
          ".gitignore"
        )
        
        for file in "${required_files[@]}"; do
          if [ ! -f "$file" ]; then
            echo "❌ Missing required file: $file"
            exit 1
          fi
          echo "✅ Found: $file"
        done

